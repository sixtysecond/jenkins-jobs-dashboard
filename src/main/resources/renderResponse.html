<html>
<head>
    <script type="text/javascript">
        var results = [
            {
                "jenkinsServerUrl": "https://builds.apache.org",
                "jobs": {
                    "Accumulo-1.6": {
                        "color": "blue",
                        "name": "Accumulo-1.6",
                        "url": "https://builds.apache.org/job/Accumulo-1.6/"
                    }
                },
                "jobNamePattern": "Accumulo-1.6",
                "lastBuilds": {
                    "Accumulo-1.6": {
                        "lastBuild": {
                            "queueId": 23820,
                            "displayName": "#919",
                            "mavenArtifacts": {},
                            "keepLog": false,
                            "description": null,
                            "fullDisplayName": "Accumulo-1.6 #919",
                            "estimatedDuration": 1416717,
                            "building": false,
                            "url": "https://builds.apache.org/job/Accumulo-1.6/919/",
                            "changeSet": {
                                "kind": "git",
                                "items": []
                            },
                            "duration": 1343226,
                            "result": "SUCCESS",
                            "number": 919,
                            "culprits": [],
                            "executor": null,
                            "mavenVersionUsed": "3.0.5",
                            "builtOn": "ubuntu3",
                            "id": "919",
                            "actions": [
                                {
                                    "causes": [
                                        {
                                            "shortDescription": "Started by an SCM change"
                                        }
                                    ]
                                },
                                {},
                                {},
                                {},
                                {
                                    "buildsByBranchName": {
                                        "origin/1.6.2-SNAPSHOT": {
                                            "marked": {
                                                "SHA1": "2ad40744839dace578ebef1ffb4b28418222ab4b",
                                                "branch": [
                                                    {
                                                        "SHA1": "2ad40744839dace578ebef1ffb4b28418222ab4b",
                                                        "name": "origin/1.6.2-SNAPSHOT"
                                                    }
                                                ]
                                            },
                                            "buildResult": null,
                                            "buildNumber": 568,
                                            "revision": {
                                                "SHA1": "2ad40744839dace578ebef1ffb4b28418222ab4b",
                                                "branch": [
                                                    {
                                                        "SHA1": "2ad40744839dace578ebef1ffb4b28418222ab4b",
                                                        "name": "origin/1.6.2-SNAPSHOT"
                                                    }
                                                ]
                                            }
                                        },
                                        "origin/1.6.0-SNAPSHOT": {
                                            "marked": {
                                                "SHA1": "1c38957c453df84462a2cd837b155d590d012d05",
                                                "branch": [
                                                    {
                                                        "SHA1": "1c38957c453df84462a2cd837b155d590d012d05",
                                                        "name": "origin/1.6.0-SNAPSHOT"
                                                    }
                                                ]
                                            },
                                            "buildResult": null,
                                            "buildNumber": 387,
                                            "revision": {
                                                "SHA1": "1c38957c453df84462a2cd837b155d590d012d05",
                                                "branch": [
                                                    {
                                                        "SHA1": "1c38957c453df84462a2cd837b155d590d012d05",
                                                        "name": "origin/1.6.0-SNAPSHOT"
                                                    }
                                                ]
                                            }
                                        },
                                        "origin/1.6.1-SNAPSHOT": {
                                            "marked": {
                                                "SHA1": "65be6dc28bd1ae479d81e740edc83045b372e76e",
                                                "branch": [
                                                    {
                                                        "SHA1": "65be6dc28bd1ae479d81e740edc83045b372e76e",
                                                        "name": "origin/1.6.1-SNAPSHOT"
                                                    }
                                                ]
                                            },
                                            "buildResult": null,
                                            "buildNumber": 560,
                                            "revision": {
                                                "SHA1": "65be6dc28bd1ae479d81e740edc83045b372e76e",
                                                "branch": [
                                                    {
                                                        "SHA1": "65be6dc28bd1ae479d81e740edc83045b372e76e",
                                                        "name": "origin/1.6.1-SNAPSHOT"
                                                    }
                                                ]
                                            }
                                        },
                                        "origin/1.6": {
                                            "marked": {
                                                "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                                "branch": [
                                                    {
                                                        "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                                        "name": "origin/1.6"
                                                    }
                                                ]
                                            },
                                            "buildResult": null,
                                            "buildNumber": 919,
                                            "revision": {
                                                "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                                "branch": [
                                                    {
                                                        "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                                        "name": "origin/1.6"
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "lastBuiltRevision": {
                                        "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                        "branch": [
                                            {
                                                "SHA1": "1619ae40985cab1f9795f0246c1bde60c1a4a8aa",
                                                "name": "origin/1.6"
                                            }
                                        ]
                                    },
                                    "scmName": "",
                                    "remoteUrls": [
                                        "git://git.apache.org/accumulo.git"
                                    ]
                                },
                                {},
                                {},
                                {},
                                {
                                    "urlName": "testReport",
                                    "failCount": 0,
                                    "totalCount": 1150,
                                    "skipCount": 6
                                },
                                {},
                                {}
                            ],
                            "artifacts": [],
                            "timestamp": 1446047171058
                        },
                        "statusCode": 200
                    }
                }
            },
            {
                "jenkinsServerUrl": "https://builds.apache.org",
                "jobs": {
                    "Accumulo-1.7": {
                        "color": "red",
                        "name": "Accumulo-1.7",
                        "url": "https://builds.apache.org/job/Accumulo-1.7/"
                    }
                },
                "jobNamePattern": "Accumulo-1.7",
                "lastBuilds": {
                    "Accumulo-1.7": {
                        "lastBuild": {
                            "queueId": 29120,
                            "displayName": "#159",
                            "mavenArtifacts": {},
                            "keepLog": false,
                            "description": null,
                            "fullDisplayName": "Accumulo-1.7 #159",
                            "estimatedDuration": 1604941,
                            "building": false,
                            "url": "https://builds.apache.org/job/Accumulo-1.7/159/",
                            "changeSet": {
                                "kind": "git",
                                "items": [
                                    {
                                        "date": "2015-11-02 10:45:40 -0500",
                                        "msg": "ACCUMULO-3356 Add the explicit default constructor for tests.",
                                        "author": {
                                            "absoluteUrl": "https://builds.apache.org/user/elserj",
                                            "fullName": "elserj"
                                        },
                                        "paths": [
                                            {
                                                "file": "server/base/src/main/java/org/apache/accumulo/server/master/balancer/ChaoticLoadBalancer.java",
                                                "editType": "edit"
                                            }
                                        ],
                                        "comment": "ACCUMULO-3356 Add the explicit default constructor for tests.\n",
                                        "commitId": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                        "id": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                        "affectedPaths": [
                                            "server/base/src/main/java/org/apache/accumulo/server/master/balancer/ChaoticLoadBalancer.java"
                                        ],
                                        "timestamp": -1
                                    }
                                ]
                            },
                            "duration": 315629,
                            "result": "FAILURE",
                            "number": 159,
                            "culprits": [
                                {
                                    "absoluteUrl": "https://builds.apache.org/user/elserj",
                                    "fullName": "elserj"
                                }
                            ],
                            "executor": null,
                            "mavenVersionUsed": "3.2.1",
                            "builtOn": "jenkins-ubuntu-1404-4gb-6a7",
                            "id": "159",
                            "actions": [
                                {
                                    "causes": [
                                        {
                                            "shortDescription": "Started by an SCM change"
                                        }
                                    ]
                                },
                                {},
                                {},
                                {},
                                {
                                    "buildsByBranchName": {
                                        "origin/1.7": {
                                            "marked": {
                                                "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                                "branch": [
                                                    {
                                                        "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                                        "name": "origin/1.7"
                                                    }
                                                ]
                                            },
                                            "buildResult": null,
                                            "buildNumber": 159,
                                            "revision": {
                                                "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                                "branch": [
                                                    {
                                                        "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                                        "name": "origin/1.7"
                                                    }
                                                ]
                                            }
                                        }
                                    },
                                    "lastBuiltRevision": {
                                        "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                        "branch": [
                                            {
                                                "SHA1": "b8ffe4c7673cd696f9e18a17f81a1a7b06c45d9f",
                                                "name": "origin/1.7"
                                            }
                                        ]
                                    },
                                    "scmName": "",
                                    "remoteUrls": [
                                        "git://git.apache.org/accumulo.git"
                                    ]
                                },
                                {},
                                {},
                                {},
                                {
                                    "urlName": "testReport",
                                    "failCount": 0,
                                    "totalCount": 83,
                                    "skipCount": 1
                                },
                                {},
                                {},
                                {},
                                {},
                                {}
                            ],
                            "artifacts": [],
                            "timestamp": 1446479350960
                        },
                        "statusCode": 200
                    }
                }
            }
        ]

        function processResult( responses ) {
            var pipelines = transformResponsesToPipelines(responses);
            document.getElementById('model').value = JSON.stringify(pipelines, null, '\t');
            renderDashboard(pipelines);
        }

        function renderDashboard( pipelines ) {

        }

        function transformResponsesToPipelines(responses) {
            var pipelines = [];
            for (var idxPipeline = 0; idxPipeline < responses.length; idxPipeline++) {
                var pipeline = {};

                var response = responses[idxPipeline];
                //alert('response' + response);

                pipeline.jenkinsServerUrl = response['jenkinsServerUrl'];
                pipeline.jobNamePattern = response['jobNamePattern'];

                var responseJobs = response['jobs'];
                //alert('responseJobs' + responseJobs);

                var responseLastBuilds = response['lastBuilds'];
                //alert('responseLastBuilds' + responseLastBuilds);

                var responseJobKeys = Object.keys(responseJobs);

                pipeline.jobs = [];
                for (var idxJob = 0; idxJob < responseJobKeys.length; idxJob++) {
                    var job = {};

                    job.name = responseJobKeys[idxJob];
                    job.url = responseJobs[job.name]['url'];
                    var lastBuild = responseLastBuilds[job.name]['lastBuild'];
                    //alert('lastBuild='+JSON.stringify(lastBuild));
                    job.statusCode = responseLastBuilds['statusCode'];
                    job.lastBuildUrl = lastBuild['url'];
                    job.duration = lastBuild['duration'];
                    job.duration_minutes = job.duration / 1000 / 60;
                    job.timestamp = lastBuild['timestamp'];

                    job.nowMillis = new Date().getTime();
                    job.millisSinceBuild = job.nowMillis - job.timestamp;
                    job.age_days = (job.millisSinceBuild / 1000 / 60 / 60 / 24).toFixed(1);
                    job.result = lastBuild['result'];
                    var lastBuildActions = lastBuild['actions'];

                    //alert('lastBuildActions='+JSON.stringify(lastBuildActions));


                    job.start = new Date(job.timestamp);
                    job.end = new Date(job.timestamp + job.duration);
                    job.building = lastBuild['building'];


                    for (var idxAction = 0; idxAction < lastBuildActions.length; idxAction++) {
                        var lastBuildAction = lastBuildActions[idxAction];
                        var actionKeys = Object.keys(lastBuildAction);

                        if ( actionKeys.indexOf('failCount') > -1 ) {
                            job.failCount = lastBuildAction['failCount'];
                        }

                        if ( actionKeys.indexOf('totalCount') > -1 ) {
                            job.totalCount = lastBuildAction['totalCount'];
                        }

                        if ( actionKeys.indexOf('skipCount') > -1 ) {
                            job.skipCount = lastBuildAction['skipCount'];
                        }
                    }
                    if (job.totalCount !== null) {
                        job.successCount = job.totalCount - job.failCount - job.skipCount;
                    }

                    pipeline.jobs.push(job);
                }
                pipelines.push(pipeline);
            }
            return pipelines;
        }


    </script>
</head>
<body>
<h1>jenkins dashboard javascript scratch pad</h1>
<button onclick="processResult(results)">Process Result</button>
<div id="dashboard">

</div>
<textarea cols="100" rows="50" id="model" name="model">
</textarea>


</body>
</html>
